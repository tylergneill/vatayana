<html>
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.25/datatables.min.css"/>
		<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.25/datatables.min.js"></script>

        <title>vātāyana: docExplore</title>

    </head>

    <body>

	    {% include "navbar.html" %}

        <div class="container">

			<!-- SEARCH ELEMENTS -->
			<form id="doc_explore_search_bar" action="/docExplore" method="POST">

				<!-- input -->
			    <div class="row">
			    	<div class="col-md-4">
<!--			            <input id="doc_id" name="doc_id" type="text" class="form-control" placeholder="Enter doc id" size="30"/>-->
						<select name="text_abbreviation_input" id="text_abbreviation_input" class="form-control">
							<option value="" size="15" selected="selected">Select text</option>
						</select>
			        </div>
					<div class="col-md-3">
						<select name="local_doc_id_input" id="local_doc_id_input" class="form-control">
							<option value="" size="15" selected="selected">Select doc id</option>
						</select>
			        </div>
					<div class="col-md-3">
						<select name="local_doc_id_input_2" id="local_doc_id_input_2" class="form-control">
							<option value="" size="15" selected="selected">Second doc id (batch mode only)</option>
						</select>
			        </div>
			        <div class="col-md-1">
			            <input id="doc_explore_submit_button" type="submit" class="btn btn-block btn-primary" value="Submit"/>
			        </div>
					<div class="col-md-1">
					</div>
			    </div>
				<div class="row" id="sw_threshold_slider_row" style='display: none;'>
					<br>
					<div class="col-md-4">
			        </div>
					<div class="col-md-5" class="range">
						<input type="range" class="form-range" name="sw_threshold" id="sw_threshold" min="20" max="200" step="10" value="50"/>
			        </div>
					<div class="col-md-1">
						<p id="sw_threshold_slider_label">sw score > 50</p>
			        </div>
					<div class="col-md-2">
			        </div>
				</div>

			</form>

            {{ docExploreInner_HTML | safe }}

        </div><!-- container -->

    <script>
		$(document).ready( function () {

	    	$('#priority_col_table').DataTable( {"pageLength": 25} );
	    	$('#secondary_col_table').DataTable( {"pageLength": 25} );
	    	$('#batch_result_table').DataTable( {"pageLength": 25} );

		} );
	</script>

	<script type="text/javascript">
		window.onload = function() {
			// ─── DOCUMENT NAVIGATION: first/prev/next/last for left & right ─────────────────

			const container = document.getElementById(`doc-explore-left`);
			if (!container) return;

			const current = container.dataset.current;
			const first   = container.dataset.first;
			const last    = container.dataset.last;

			['first','prev','next','last'].forEach(type => {
			  const btn = document.getElementById(`btn-${type}-explore`);
			  if (!btn) return;

			  // hide first & prev at the start
			  if ((type === 'first' || type === 'prev') && current === first) {
				btn.disabled = true;
				btn.classList.add('disabled');
			  }
			  // hide next & last at the end
			  if ((type === 'next' || type === 'last') && current === last) {
				btn.disabled = true;
				btn.classList.add('disabled');
			  }
			});
		}

    	var abbrv2docs = {{ abbrv2docs|tojson|safe }};
		var abbrev2title = {{ text_abbrev2title|tojson|safe }};
		var section_labels = {{ section_labels|tojson|safe }};

		var initial_values = {
			text_abbreviation: "{{ text_abbreviation }}",
			local_doc_id: "{{ local_doc_id }}",
			local_doc_id_2: "{{ local_doc_id_2 }}",
			textSelId: "text_abbreviation_input",
			docSelId: "local_doc_id_input",
			docSelId2: "local_doc_id_input_2"
		};
		console.log(initial_values.local_doc_id)
		console.log(initial_values.local_doc_id_2)

		function setupSelectorTrio(
			textSelId,
			docSelId,
			docSelId2,
			initialTextAbbr,
			initialDocId,
			initialDocId2,
		) {

			var textSel = document.getElementById(textSelId);
			var docSel1 = document.getElementById(docSelId);
			var docSel2 = document.getElementById(docSelId2);

			// Reset text abbreviation options
			textSel.length = 1;  // keep dummy option
			for (var abbrev in abbrv2docs) {
				textSel.options[textSel.options.length] = new Option(abbrev + ' ' + abbrev2title[abbrev], abbrev);
			}
			textSel.value = initialTextAbbr;

			// Populate doc IDs for that abbreviation
			function populateDocIds(abbreviation) {
				docSel1.length = 1;  // keep the dummy option
				docSel2.length = 1
				for (var docId of abbrv2docs[abbreviation]) {
					var label = section_labels[abbreviation + '_' + docId] || '';
					docSel1.options[docSel1.options.length] = new Option(docId + ' ' + label, docId);
					docSel2.options[docSel2.options.length] = new Option(docId + ' ' + label, docId);
				}
			}

			// Initial population of doc IDs
			populateDocIds(initialTextAbbr);
			docSel1.value = initialDocId;
			docSel2.value = initialDocId2;

			// Wire up onchange for future changes
			textSel.onchange = function() {
				populateDocIds(this.value);
			};

			// docSel2 onchange triggers slider row to appear
			docSel2.onchange = function() {
				var sw_threshold_slider_row = document.getElementById("sw_threshold_slider_row");
				if (sw_threshold_slider_row) {
					sw_threshold_slider_row.style.display = "block";
				}
			};

			// Slider label update (only if slider exists)
			var sw_threshold = document.getElementById("sw_threshold");
			var sw_threshold_slider_label = document.getElementById("sw_threshold_slider_label");
			if (sw_threshold && sw_threshold_slider_label) {
				sw_threshold.oninput = function() {
					sw_threshold_slider_label.innerHTML = `sw score > ${sw_threshold.value}`;
				};
			}
		}

		// --- Apply to the trio of dropdowns ---
		setupSelectorTrio(
			initial_values.textSelId,
			initial_values.docSelId,
			initial_values.docSelId2,
			initial_values.text_abbreviation,
			initial_values.local_doc_id,
			initial_values.local_doc_id_2
		);

    </script>

	</body>

</html>