<html>
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

        <title>vātāyana: docCompare</title>

    </head>

    <body>

        {% include "navbar.html" %}

        <div class="container">

			<div class="row">

				<form id="doc_compare_search_bar" action="/docCompare" method="POST">

<!--				<div class="col-md-3">-->
<!--		            <input id="doc_id_1" name="doc_id_1" type="text" class="form-control" placeholder="Enter doc id 1" value="{{ doc_id_1 }}" size="30"/>-->
<!--		        </div>-->

<!--		        <div class="col-md-3">-->
<!--			    </div>-->

<!--		    	<div class="col-md-3">-->
<!--		            <input id="doc_id_2" name="doc_id_2" type="text" class="form-control" placeholder="Enter doc id 2" value="{{ doc_id_2 }}" size="30"/>-->
<!--		        </div>-->

<!--		        <div class="col-md-1">-->
<!--			    </div>-->

<!--		        <div class="col-md-2">-->
<!--		            <input id="doc_compare_search_submit_button" type="submit" class="btn btn-block btn-primary" value="Submit"/>-->
<!--			    </div>-->

					<!-- input -->
					<div class="row">
						<div class="col-md-2">
							<select name="text_abbreviation_input_1" id="text_abbreviation_input_1" class="form-control">
								<option value="" size="15" selected>Select text</option>
							</select>
						</div>
						<div class="col-md-3">
							<select name="local_doc_id_input_1" id="local_doc_id_input_1" class="form-control">
								<option value="" size="15" selected>Select doc id</option>
							</select>
						</div>
						<div class="col-md-1">
						</div>
						<div class="col-md-2">
							<select name="text_abbreviation_input_2" id="text_abbreviation_input_2" class="form-control">
								<option value="" size="15" selected>Select text</option>
							</select>
						</div>
						<div class="col-md-3">
							<select name="local_doc_id_input_2" id="local_doc_id_input_2" class="form-control">
								<option value="" size="15" selected>Select doc id</option>
							</select>
						</div>
						<div class="col-md-1">
							<input id="doc_compare_submit_button" type="submit" class="btn btn-block btn-primary" value="Submit"/>
						</div>
					</div>

			    </form>

			</div>


            {{ docCompareInner_HTML | safe }}

        </div><!-- container -->

        <script>
        	function conditionally_display_similar_doc_link_buttons() {
                sim_btn_left = "{{ activate_similar_link_buttons_left }}";
                if ( sim_btn_left.length > 0 ) {
                    document.getElementById("sim-nav-left").style.visibility = "visible";
                }
                sim_btn_right = "{{ activate_similar_link_buttons_right }}";
                if ( sim_btn_right.length > 0 ) {
                    document.getElementById("sim-nav-right").style.visibility = "visible";
                }
            }

         	window.onload = function() {
                conditionally_display_similar_doc_link_buttons();

              // ─── DOCUMENT NAVIGATION: first/prev/next/last for left & right ─────────────────
			  ['left','right'].forEach(side => {
				const container = document.getElementById(`doc-compare-${side}`);
				if (!container) return;

				const current = container.dataset.current;
				const first   = container.dataset.first;
				const last    = container.dataset.last;

				['first','prev','next','last'].forEach(type => {
				  const btn = document.getElementById(`btn-${type}-${side}`);
				  if (!btn) return;

				  // hide first & prev at the start
				  if ((type === 'first' || type === 'prev') && current === first) {
					btn.disabled = true;
					btn.classList.add('disabled');
				  }
				  // hide next & last at the end
				  if ((type === 'next' || type === 'last') && current === last) {
					btn.disabled = true;
					btn.classList.add('disabled');
				  }
				});
			  });

			  // ─── SIMILARITY NAVIGATION: for left & right ─────────────────────────────────────
			  ['left','right'].forEach(side => {
				const simNav = document.getElementById(`sim-nav-${side}`);
				if (!simNav) return;

				const rank  = parseInt(simNav.dataset.rank,  10) || 0;
				const total = parseInt(simNav.dataset.total, 10) || 0;

				// always show the row
				simNav.style.display = '';

				// hide entire row if invalid rank
				if (rank < 1 || rank > total) {
				  simNav.style.display = 'none';
				  return;
				}

				// hide the “more similar” button at rank 1
				const btnPrev = document.getElementById(`sim-prev-btn-${side}`);
				if (rank === 1 && btnPrev) {
				  btnPrev.disabled = true;
				  btnPrev.classList.add('disabled');
				}

				// hide the “less similar” button at rank=total
				const btnNext = document.getElementById(`sim-next-btn-${side}`);
				if (rank === total && btnNext) {
				  btnNext.disabled = true;
				  Next.classList.add('disabled');
				}
			  });
            }

			var abbrv2docs = {{ abbrv2docs|tojson|safe }};
			var abbrev2title = {{ text_abbrev2title|tojson|safe }};
			var section_labels = {{ section_labels|tojson|safe }};

			var initial_values = [
				{
					text_abbreviation: "{{ text_abbreviation_1 }}",
					local_doc_id: "{{ local_doc_id_1 }}",
					textSelId: "text_abbreviation_input_1",
					docSelId: "local_doc_id_input_1"
				},
				{
					text_abbreviation: "{{ text_abbreviation_2 }}",
					local_doc_id: "{{ local_doc_id_2 }}",
					textSelId: "text_abbreviation_input_2",
					docSelId: "local_doc_id_input_2"
				}
			];

			function setupSelectorPair(textSelId, docSelId, initialTextAbbr, initialDocId) {
				var textSel = document.getElementById(textSelId);
				var docSel = document.getElementById(docSelId);

				// Reset text abbreviation options
				textSel.length = 1;  // keep the dummy option
				for (var abbrev in abbrv2docs) {
					textSel.options[textSel.options.length] = new Option(abbrev + ' ' + abbrev2title[abbrev], abbrev);
				}

				// Set initial abbreviation
				textSel.value = initialTextAbbr;

				// Populate doc IDs for that abbreviation
				function populateDocIds(abbreviation) {
					docSel.length = 1;  // keep the dummy option
					for (var docId of abbrv2docs[abbreviation]) {
						var label = section_labels[abbreviation + '_' + docId] || '';
						docSel.options[docSel.options.length] = new Option(docId + ' ' + label, docId);
					}
				}

				// Initial population of doc IDs
				populateDocIds(initialTextAbbr);
				docSel.value = initialDocId;

				// Wire up onchange for future changes
				textSel.onchange = function() {
					populateDocIds(this.value);
				};
			}

			// --- Apply to both pairs ---
			for (var pair of initial_values) {
				setupSelectorPair(pair.textSelId, pair.docSelId, pair.text_abbreviation, pair.local_doc_id);
			}
        </script>

    </body>

</html>